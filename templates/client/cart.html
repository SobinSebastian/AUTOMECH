{% extends 'client/base.html' %}
{%block content%}
{% load static %}
<div class="blog">
    <div class="container mt-5">
        <div class="section-header text-center">
            <p>Service</p>
            <h2>Cart</h2>
        </div>
        <div class="row">
            {% if cart_items %}
            <div class="container mt-2">                
                <!-- Cart Items -->
                <table class="table">
                    <thead>
                        <tr>
                            <th></th>
                            <th>Service Name</th>
                            <th>Vehicle</th>
                            <th>Price</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody>
                        <!-- Loop through your cart items and display them -->
                        {% for item in cart_items %}
                            <tr>
                                <td><img src="{{item.cart_item.service_list.service_Image.url }}" width="100" alt="Your Image"></td>
                                <td>{{ item.cart_item.service_list.service_name }}</td>
                                <td>{{ item.cart_item.vehicle_info.vehicle_Regno }}({{ item.cart_item.vehicle_info.model_variant }})</td>
                                <td> <B>₹ {{ item.price }}</b></td>
                                <td>
                                    <!-- Add actions like remove item -->
                                    <form method="POST" action="{% url 'remove_from_cart' item.cart_item.slug %}">
                                        {% csrf_token %}
                                        <button type="submit" class="btn btn-danger btn-sm">Remove</button>
                                    </form>
                                </td>
                            </tr>
                        {% endfor %}
                    </tbody>
                </table>
            
                <!-- Total Price -->
                <div class="text-right">
                    <h4>Total: ₹ {{ total_price }}</h4>
                </div>
            
                <!-- Continue shopping or checkout buttons -->
                <div class="mt-3">
                    <a href="{%url 'index'%}" class="btn btn-primary">Continue Shopping</a>
                    <button type="button" class="btn btn-success" data-toggle="modal" data-target="#exampleModalCenter">
                        Checkout
                    </button>
                </div>
            </div>
            {%else%}
                <img src="{% static 'img/empty-cart.png'%}" alt="Image" class="mx-auto d-block">
            {%endif%}
        </div>
    </div>
</div>


  
  <!-- Modal -->
  <div class="modal fade" id="exampleModalCenter" tabindex="-1" role="dialog" aria-labelledby="exampleModalCenterTitle" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered" role="document">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="exampleModalLongTitle">Book Service</h5>
          <button type="button" class="close" data-dismiss="modal" aria-label="Close">
            <span aria-hidden="true">&times;</span>
          </button>
        </div>
        <div class="modal-body">

            <form method="post" action="">
                {% csrf_token %}
                
                <label for="id_service_center">Service Center:</label>
                <select name="service_center" id="id_service_center" class="form-control">
                    <!-- Populate this dropdown with your service centers dynamically -->
                    {% for service_center in service_centers %}
                        <option value="{{ service_center.id }}">{{ service_center.place }} - {{ service_center.city }}</option>
                        <!-- You can include other information in the option label as needed -->
                    {% endfor %}
                    <!-- Add more options as needed -->
                </select>
                <div id="id_service_center_error" class="text-danger"></div> <!-- Error field -->
            
                <br>
                
                <label for="id_date">Booking Date:</label>
                <input type="date" name="date" id="id_date" class="form-control datepicker" placeholder="YYYY-MM-DD">
                <div id="id_date_error" class="text-danger"></div> <!-- Error field -->
            
                <br>
                
                <label for="id_time">Booking Time:</label>
                <input type="time" name="time" id="id_time" class="form-control timepicker" placeholder="HH:MM">
                <div id="id_time_error" class="text-danger"></div> <!-- Error field -->
            
                <br>
            
              

        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary btn-sm" data-dismiss="modal">Close</button>
          <button type="submit" class="btn btn-primary btn-sm">Submit</button>
        </form>
        </div>
      </div>
    </div>
  </div>

<script src="https://code.jquery.com/jquery-3.6.4.min.js"></script>
<script>
    $(document).ready(function () {
        // Service Center validation
        $('#id_service_center').change(function () {
            validateServiceCenter();
        });

        // Date validation
        $('#id_date').change(function () {
            validateDate();
        });

        // Time validation
        $('#id_time').change(function () {
            validateTime();
        });

        $('form').submit(function (event) {
            if (!validateServiceCenter() || !validateDate() || !validateTime()) {
                event.preventDefault();
            }
        });

        function showErrorMessage(elementId, message) {
            $('#' + elementId + '_error').text(message);
        }

        function hideErrorMessage(elementId) {
            $('#' + elementId + '_error').text('');
        }

        function validateServiceCenter() {
            var serviceCenter = $('#id_service_center').val();
            if (!serviceCenter) {
                showErrorMessage('id_service_center', 'Please select a service center.');
                return false;
            } else {
                hideErrorMessage('id_service_center');
            }
            return true;
        }

        function validateDate() {
            var date = $('#id_date').val();
            if (!date) {
                showErrorMessage('id_date', 'Date cannot be empty.');
                return false;
            }

            var currentDate = new Date();
            var selectedDate = new Date(date);
            if (selectedDate < currentDate) {
                showErrorMessage('id_date', 'Please select a future date.');
                return false;
            } else {
                hideErrorMessage('id_date');
            }
            return true;
        }

        function validateTime() {
            var time = $('#id_time').val();
            if (!time) {
                showErrorMessage('id_time', 'Time cannot be empty.');
                return false;
            }

            var selectedTime = new Date('1970-01-01T' + time);
            var startTime = new Date('1970-01-01T08:00');
            var endTime = new Date('1970-01-01T16:00');
            if (selectedTime < startTime || selectedTime > endTime) {
                showErrorMessage('id_time', 'Please select a time between 8:00 AM and 4:00 PM.');
                return false;
            } else {
                hideErrorMessage('id_time');
            }
            return true;
        }
    });
</script>


{%endblock%}