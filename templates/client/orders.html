{% extends 'client/base.html' %}
{%block content%}
{% load static %}
<div class="blog">
    <div class="container mt-5">
        <div class="section-header text-center">
            <p>Service</p>
            <h2>Orders</h2>
        </div>
            {% if serviceorders %}
            <div class="container mt-5">
                <table class="table">
                  <thead>
                    <tr>
                      <th scope="col">Vehicle</th>
                      <th scope="col">Service Center</th>
                      <th scope="col">Date & time</th>
                      <th scope="col">Status</th>
                      <th scope="col">Actions</th>
                    </tr>
                  </thead>
                  <tbody>
                    {% for oder in serviceorders%}
                            <tr  data-toggle="collapse" data-target="#details{{oder.slug}}" class="clickable">
                                <td>{{ oder.vehicle.vehicle_Regno }}({{ oder.vehicle.model_variant }})</td>
                                <td>{{oder.service_center.place}},{{oder.service_center.city}}</td>
                                <td>{{oder.date}} ,{{oder.time}}</td>
                                <td>
                                    {{oder.status}}
                                </td>
                                <td><button type="button" class="btn btn-success">View More</button></td>
                            </tr>
                            <tr id="details{{oder.slug}}" class="collapse">
                                <td colspan="5" >
                                    <div class="rounded border border-primary">
                                        <div class="card-body">
                                            <button class="btn btn-primary">Reschedule</button>
                                    <B>Service Order Details</B>
                                    <table class="table table-info">
                                        <thead>
                                            <tr>
                                                <th>Service Name</th>
                                                <th>Price</th>
                                                <th>Status</th>
                                                <th>Actions</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                        {%for item in order_items%}
                                            {%if oder.id == item.order_item.service_order.id%}
                                            <tr>
                                                <td>{{item.order_item.service_list}}</td>
                                                <td>₹ {{ item.price }}</td> 
                                                <td>{{item.order_item.status}}</td>
                                                <td>
                                                    <button type="button" class="btn btn-danger" {% if item.order_item.status == 'completed' %} disabled {% endif %}>
                                                        Cancel
                                                    </button>
                                                </td>
                                                
                                            </tr>
                                            {%endif%}
                                        {%endfor%}
                                        </tbody>
                                    </table>
                                    <div class="text-right">
                                        {% for forder in serviceorder_prices %}
    {% if forder.service_order == oder %}
        <div class="text-right">
            <h4>Estimated Total: ₹ {{ forder.total_price }}</h4>
            {% if oder.status == 'on hold' %}
                <br>
                <a href="{% url 'generate_estimate_pdf' oder.slug %}">download</a>
            {% endif %}
            <a href="{% url 'bill_pay' oder.slug %}">PAY</a>
            
        </div>
    {% endif %}
{% endfor %}
                                    </div>
                                </div>
                                </td>
                              </tr>
                    {% endfor %}
                  </tbody>
                </table>
              </div>             
            </div>
        
            {%else%}
                <img src="{% static 'img/empty-cart.png'%}" alt="Image" class="mx-auto d-block">
            {%endif%} 
        </div>
    </div>
</div>


  
  <!-- Modal -->
  <div class="modal fade" id="exampleModalCenter" tabindex="-1" role="dialog" aria-labelledby="exampleModalCenterTitle" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered" role="document">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="exampleModalLongTitle">Book Service</h5>
          <button type="button" class="close" data-dismiss="modal" aria-label="Close">
            <span aria-hidden="true">&times;</span>
          </button>
        </div>
        <div class="modal-body">

            <form method="post" action="">
                {% csrf_token %}
                
                <label for="id_service_center">Service Center:</label>
                <select name="service_center" id="id_service_center" class="form-control">
                    <!-- Populate this dropdown with your service centers dynamically -->
                    {% for service_center in service_centers %}
                        <option value="{{ service_center.id }}">{{ service_center.place }} - {{ service_center.city }}</option>
                        <!-- You can include other information in the option label as needed -->
                    {% endfor %}
                    <!-- Add more options as needed -->
                </select>
                <div id="id_service_center_error" class="text-danger"></div> <!-- Error field -->
            
                <br>
                
                <label for="id_date">Booking Date:</label>
                <input type="date" name="date" id="id_date" class="form-control datepicker" placeholder="YYYY-MM-DD">
                <div id="id_date_error" class="text-danger"></div> <!-- Error field -->
            
                <br>
                
                <label for="id_time">Booking Time:</label>
                <input type="time" name="time" id="id_time" class="form-control timepicker" placeholder="HH:MM">
                <div id="id_time_error" class="text-danger"></div> <!-- Error field -->
            
                <br>
            
              

        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary btn-sm" data-dismiss="modal">Close</button>
          <button type="submit" class="btn btn-primary btn-sm" >Submit</button>
        </form>
        </div>
      </div>
    </div>
  </div>


{%endblock%}